

<script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.0/knockout-min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"> </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/yamljs/0.3.0/yaml.js"></script>

<body>
  
  <div>
  This is a test page
  </div>
  <div class="row">
      <label for="Yaml"> Select your YAML: </label>
      <input type="file" name="Yaml" id="Yaml" accept=".yaml" data-bind="event: { change: function() { uploadYAML($element.files[0]) } }" />
  </div>

</body>

<script>
  function YamlViewModel() {
    var self = this;
    self.baseString=""
        //Knockout obervables, which will be editted by the client, and then used later. 
    self.uploadYAML = function (file){
      f= new FileReader();
      
      f.readAsText(file)
      
      f.onload = function() {
        console.log(f.result);
        self.x=YAML.parse(f.result);
        console.log(self.x);
        
        y=self.x["objectives"]
        self.baseString+= "Objectives: "
        self.parseSub(y)
        
        y=self.x["keyitems"]
        self.baseString+= "Keyitems: "
        self.parseSub(y)
        
        y=self.x["pass"]
        self.baseString+= "Pass: "
        self.parseSub(y)
        
        y=self.x["characters"]
        self.baseString+= "Characters: "
        self.parseSub(y)
        
        y=self.x["treasures"]
        self.baseString+= "Treasures: "
        self.parseSub(y)
        
        y=self.x["shops"]
        self.baseString+= "Shops: "
        self.parseSub(y)
        
        y=self.x["encounters"]
        self.baseString+= "Encounters: "
        self.parseSub(y)
        
        y=self.x["glitches"]
        self.baseString+= "Glitches: "
        self.parseSub(y)
        
        y=self.x["other"]
        self.baseString+= "Other: "
        self.parseSub(y)
        
        y=self.x["misc_vanilla"]
        self.baseString+= "misc_vanilla: "
        self.parseSub(y)
        
        console.log(self.x)
        console.log(self.baseString)
      };
      
      self.parseSub=function(a){
        k=Object.keys(a);
        for( i of k){
          b=Object.keys(a[i]);
          for(c of b){
            if(a[i][c]==0){
              delete(a[i][c]);
            }
          }
          b=Object.keys(a[i]);
          if(b.length==1){
            if(b[0]=="On"){
              self.baseString+= i +" ";
            } else if(b[0]!="Off"){
              self.baseString+= i +":" b[0]+" ";
            }
            delete(a)
          }
        }
      }
    }
  }
  ko.applyBindings(new YamlViewModel());
</script>
